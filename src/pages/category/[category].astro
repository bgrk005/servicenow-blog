---
import Layout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  const categories = [...new Set(posts.map(p => p.data.category))];

  return categories.map(category => ({
    params: { category },
    props: { category, posts: posts.filter(p => p.data.category === category) },
  }));
}

const { category, posts } = Astro.props;
---

<Layout title={`Posts in ${category}`}>
  <h1>Category: {category}</h1>
  <ul>
    {posts.map(p => (
      <li><a href={`/posts/${p.slug}/`}>{p.data.title}</a></li>
    ))}
  </ul>
</Layout>
